graphs:

- id: ERP
  nodes:
  - id: sub
    module: timeflux.nodes.zmq
    class: Sub
    params:
      topics: [filtered, events]
  - id: epoch_erp
    module: timeflux.nodes.epoch
    class: Samples
    params:
      trigger: epoch
      length: {{ ERP_LENGTH }}
  - id: accumulate_epochs
    module: nodes.accumulation.epochs_accumulation
    class: AccumulateEpochs
    params:
      buffer_size: {{ ERP_BUFFER_SIZE }}
      verbose: {{ERP_VERBOSE}}
      meta_label: [epoch, context, bit]
      target_label: 1
      event_start_accumulation: calibration_begins
      event_stop_accumulation: calibration_ends
  - id: pub_erp
    module: timeflux.nodes.zmq
    class: Pub
    params:
      topic: erp
  edges:
    - source: sub:filtered
      target: epoch_erp
    - source: sub:events
      target: epoch_erp:events
    - source: sub:events
      target: accumulate_epochs:events
    - source: epoch_erp:*
      target: accumulate_epochs
    - source: accumulate_epochs
      target: pub_erp
  rate: 10